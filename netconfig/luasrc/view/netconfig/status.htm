<%+header%>
<h2>网络配置 - 状态</h2>

<div class="cbi-map">
    <div class="cbi-section">
        <button id="pull-apply-btn" class="cbi-button cbi-button-action">拉取并应用配置</button>
        <br><br>
        <div id="output-area" style="
            padding:10px; 
            border:1px solid #ccc; 
            height:600px; 
            width:100%; 
            box-sizing:border-box; 
            overflow-y:auto; 
            white-space:pre-wrap;
            background:#f9f9f9;
        "></div>
    </div>
</div>

<script type="text/javascript">
function showOutput(text) {
    const area = document.getElementById('output-area');
    area.textContent += text + '\n';
    area.scrollTop = area.scrollHeight;
}

function clearOutput() {
    document.getElementById('output-area').textContent = '';
}

document.getElementById('pull-apply-btn').onclick = function() {
    this.disabled = true;
    clearOutput();
    showOutput('=== 开始执行配置同步 ===');

    // 调用正确的路由：pull_apply（绑定 action_apply）
    fetch('<%=luci.dispatcher.build_url("admin/system/netconfig/pull_apply")%>')
        .then(res => res.json())
        .then(data => {
            showOutput('\n--- 执行结果 ---');
            showOutput(data.output || '无内容');
            showOutput('\n=== 操作完成 ===');
        })
        .catch(err => {
            showOutput('\n=== 错误 ===');
            showOutput(err.message);
        })
        .finally(() => {
            document.getElementById('pull-apply-btn').disabled = false;
        });
};
</script>

<%+footer%>